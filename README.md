
這個 IO EXT 程式是使用 Keil C 與 8051 設計的，

主要是控制 NXP PCA9555 晶片做 IO 延伸控制使用，

為了增加 GPIO 不夠用的問題，一顆中有兩組 IO PORT，

可以搭配 EXT INT 外部中斷 PIN 控制進入 ISR 做動作， 


程式部份參考說明：

===================================================

為什麼要用那個 marco ... 其實這裡的程式是這樣：

我們使用一顆 pca9555，有兩組的 io ext 就是 16 bit

也就是說外部的資料中多了兩 port 的 gpio

那麼我們在內部就定義出兩個 byte 的資料設為 p0 與 p1

當我們要寫入 io ext (pca9555) 時，我們就先呼叫一下 macro

LED_NTSC1(ON),LED_NTSC2(OFF),LED_PAL1(OFF);
LED_PALN(OFF),LED_PAL2(OFF),LED_PALM(OFF);

其實這裡的巨集只是把 pn_data_port 的某一個 bit 設為 |= 0x01 或是 &~=0x01

就是舉起或是落下而已，為什麼要這樣寫，因為多半用這類 io ext 都是這樣設計，這樣你要點亮那一顆 led 或是關那一顆 led

只要在送 write 前先: LED_NTSC1(ON);

這樣

temp[1]=PCA9555_LED_PORT.p0;
temp[2]=PCA9555_LED_PORT.p1;

的資料就會被設定好了，

=====================================================

剛剛我解釋 I2C IO EXT IC 的控制方式給我爸爸聽了，

並且他真的聽懂了... 

這方法不錯，我這樣說一下，我們今天把 HOST IC 就是 PI，

當成是媽媽，然後 IO EXT IC 是小孩~ 叫 JACK. 就是 DEV，

然後控制 SM BUS 就是說話，然後 SLAVE COMMAND 就是指令，

有回應就是 CONF I，有控制就是 CONF O，也有舉手腳與不舉手腳，

在 SPEC 上面會有 COMMAND 的範圍，就是小孩的習慣，

好了~ 情境，媽媽帶 JACK 去市場買菜，

媽媽已經全手都拿滿東西了，但是媽媽還想要買一顆白菜，

媽媽 說 JACK. - JACK 答右，

你的左手去拿白菜，JACK 拿完回答好，

結束，

然後... 媽媽又看到海帶不錯!!

媽媽 說 JACK. - JACK 答右，

你的右手拿什麼? JACK 回說小玩具，媽媽說喔!

然後媽媽 說 丟了 <= 這裡我們看到 I2C 不做 STOP 結束字元是可以繼續給命令的，但是要看一下 SPEC 方法，

JACK 把小玩具丟了後 回答好，

然後媽媽 說 你的右手去拿海帶，JACK 拿到海帶後 答好，

結束，

媽媽在路上突然看到一個大便在 JACK 右腳前 @@!!!

媽媽 說 JACK. - JACK 答右，

媽媽 說 右腳抬起，JACK 抬起右腳後 答好，

結束，

所以我們得到 JACK 左手上拿著一顆白菜，而右手上拿一包海帶，

抬起的右腳前方有一團大便...

以上.

這就是控制 IO EXT 的方法...







